language: java

# Use all available jdk7/8 that are still compatible with everything except for Tomcat 6
jdk:
  - oraclejdk8
  - oraclejdk7
  - openjdk7

# Exclude Tomcat 6 compilation on jdk7/8
script: mvn verify -pl !container/tomcat6

# Include Tomcat-specific builds that uses proper Tomcat 6/7/8 dependencies and AS7 with jbossweb7 dependency
matrix:
  include:
  - jdk: openjdk6
    script: mvn verify -PTC6
  - jdk: openjdk7
    script: mvn verify -PTC7
  - jdk: oraclejdk7
    script: mvn verify -PTC7
  - jdk: oraclejdk8
    script: mvn verify -PTC7
  - jdk: openjdk7
    script: mvn verify -PTC8
  - jdk: oraclejdk7
    script: mvn verify -PTC8
  - jdk: oraclejdk8
    script: mvn verify -PTC8
  - jdk: openjdk7
    script: mvn verify -PAS7
  - jdk: oraclejdk7
    script: mvn verify -PAS7
  - jdk: oraclejdk8
    script: mvn verify -PAS7

# Don't send notifications, just update the PR statuses
notifications:
  email: false

# Workaround openjdk6/7 crashes in container-based environments failing with:
# *** buffer overflow detected ***: /usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java terminated
# /usr/lib/jvm/java-7-openjdk-amd64/jre/lib/amd64/libnet.so(Java_java_net_Inet4AddressImpl_getLocalHostName+0x190)[0x7fde947f34a0]
sudo: required
addons:
  hostname: localhost
